<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MTG NFC — Quick Access (Screen Reader Friendly)</title>
  <meta name="description" content="Simple, high-contrast, keyboard-first MTG NFC card viewer optimized for screen readers and fast access during games." />
  <style>
    /* Minimal, high-contrast, large text for readability */
    :root{--bg:#000;--fg:#fff;--muted:#cbd5e1;--accent:#0ea5a4}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;line-height:1.4}
    .wrap{max-width:900px;margin:12px auto;padding:12px}
    h1{font-size:1.6rem;margin:0 0 8px}
    p.lead{color:var(--muted);margin:0 0 12px}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input[type="search"]{width:100%;padding:10px;font-size:1.05rem;border-radius:6px;border:2px solid #333;background:#050505;color:var(--fg)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button{background:#111;color:var(--fg);border:2px solid #333;padding:8px 12px;border-radius:6px;font-size:1rem;cursor:pointer}
    button.primary{background:var(--accent);color:#000;border:none}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .card-region{margin-top:14px;padding:12px;border-radius:8px;background:#050505;border:2px solid #222}
    .card-line{margin:6px 0;font-size:1.05rem}
    .meta{color:var(--muted);font-size:0.95rem}
    .small{font-size:0.95rem}
    .key-help{margin-top:10px;color:var(--muted);font-size:0.9rem}
    footer{margin-top:18px;color:var(--muted);font-size:0.9rem}
    /* Focus styles for keyboard users */
    button:focus,input:focus{outline:3px solid #fff;outline-offset:2px}
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="MTG NFC quick viewer">
    <h1>MTG NFC — Quick Access</h1>
    <p class="lead">Optimized for screen readers and fast use at the table. Type an ID (e.g., PIR-001) or part of a name, then press Enter.</p>

    <label for="search">Find card by ID or name</label>
    <input id="search" type="search" inputmode="search" placeholder="Type PIR-001 or 'Schooner' and press Enter" aria-describedby="searchHint" />

    <div id="searchHint" class="sr-only">Press Enter to select. Use Arrow Left/Right to move between results. Press C to copy URL, O to open URL in a new tab. Press / to focus search.</div>

    <div class="controls" aria-hidden="false">
      <button id="prevBtn" title="Previous card (Left arrow or P)">Previous</button>
      <button id="nextBtn" title="Next card (Right arrow or N)">Next</button>
      <button id="copyBtn" class="primary" title="Copy NFC URL (C)">Copy URL</button>
      <button id="openBtn" title="Open NFC URL (O)">Open</button>
      <button id="listBtn" title="List all card IDs for quick navigation">List IDs</button>
    </div>

    <div id="card" class="card-region" role="region" aria-live="polite" aria-atomic="true" tabindex="-1">
      <div id="cardName" class="card-line meta">No card selected</div>
      <div id="cardType" class="card-line small"></div>
      <div id="cardCost" class="card-line small"></div>
      <div id="cardText" class="card-line"></div>
      <div id="cardStats" class="card-line meta"></div>
      <div id="cardUrl" class="sr-only" aria-hidden="false"></div>
    </div>

    <div id="idList" class="sr-only" aria-hidden="true"></div>

    <div class="key-help">
      Keyboard shortcuts: / focus search · Enter select · ← / P previous · → / N next · C copy URL · O open URL · L list IDs
    </div>

    <footer>
      Tip: Save this page to your home screen or use a browser bookmark for fastest access during games.
    </footer>

    <div id="announcer" class="sr-only" aria-live="polite"></div>
  </div>

  <script>
    // Simple, fast, screen-reader friendly logic
    const searchInput = document.getElementById('search');
    const cardName = document.getElementById('cardName');
    const cardType = document.getElementById('cardType');
    const cardText = document.getElementById('cardText');
    const cardCost = document.getElementById('cardCost');
    const cardStats = document.getElementById('cardStats');
    const cardUrlHidden = document.getElementById('cardUrl');
    const announcer = document.getElementById('announcer');
    const idListDiv = document.getElementById('idList');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const copyBtn = document.getElementById('copyBtn');
    const openBtn = document.getElementById('openBtn');
    const listBtn = document.getElementById('listBtn');

    // Try to fetch cards.json; fallback to a compact inline set if not found
    let cardDatabase = {};
    let ids = [];
    let currentIndex = -1;

    const fallback = {
      "PIR-001": {"id":"PIR-001","name":"Subterranean Schooner","cost":"2 blue","type":"Artifact — Vehicle","text":"Whenever Subterranean Schooner attacks, target creature that crewed it this turn explores. Crew: 1","power":3,"toughness":4},
      "PIR-004": {"id":"PIR-004","name":"Inti, Seneschal of the Sun","cost":"red white","type":"Legendary Creature — Human Soldier","text":"Whenever you attack, you may discard a card. When you do, put a +1/+1 counter on target attacking creature. That creature gains trample until end of turn. Whenever you discard one or more cards, exile the top card of your library. You may play that card until your next end step.","power":2,"toughness":2},
      "PIR-007": {"id":"PIR-007","name":"Gastal Thrillroller","cost":"2 red","type":"Artifact — Vehicle","text":"Whenever Gastal Thrillroller attacks, it deals 1 damage to each opponent. Crew: 2","power":4,"toughness":3},
      "PIR-008": {"id":"PIR-008","name":"Fearless Swashbuckler","cost":"1 red","type":"Creature — Human Pirate","text":"Menace","power":2,"toughness":1},
      "PIR-011": {"id":"PIR-011","name":"Captain Howler, Sea Scourge","cost":"3 blue","type":"Creature — Siren Pirate","text":"Flying. Whenever Captain Howler attacks, tap up to one target creature.","power":3,"toughness":3},
      "PIR-013": {"id":"PIR-013","name":"Spyglass Siren","cost":"blue","type":"Creature — Siren Pirate","text":"Flying. When Spyglass Siren enters the battlefield, create a Map token.","power":1,"toughness":1},
      "PIR-017": {"id":"PIR-017","name":"Marauding Mako","cost":"blue","type":"Creature — Shark Pirate","text":"Whenever you discard a card, put a +1/+1 counter on Marauding Mako.","power":1,"toughness":1},
      "PIR-021": {"id":"PIR-021","name":"Scrounging Skyray","cost":"2 blue","type":"Creature — Fish Pirate","text":"Flying. Whenever you discard a card, Scrounging Skyray gains hexproof until end of turn.","power":2,"toughness":3},
      "PIR-025": {"id":"PIR-025","name":"Staunch Crewmate","cost":"1 blue","type":"Creature — Human Pirate","text":"When Staunch Crewmate enters the battlefield, scry 2.","power":2,"toughness":1},
      "PIR-027": {"id":"PIR-027","name":"Burst Lightning","cost":"red","type":"Instant","text":"Burst Lightning deals 2 damage to any target. Kicker 4.","power":null,"toughness":null},
      "PIR-031": {"id":"PIR-031","name":"Broadside Barrage","cost":"1 red","type":"Sorcery","text":"Broadside Barrage deals 2 damage to any target.","power":null,"toughness":null},
      "PIR-033": {"id":"PIR-033","name":"Spell Snare","cost":"blue","type":"Instant","text":"Counter target spell with mana value 2.","power":null,"toughness":null},
      "PIR-035": {"id":"PIR-035","name":"Secluded Courtyard","cost":"","type":"Land","text":"As Secluded Courtyard enters the battlefield, choose a creature type. Tap: Add one colorless mana. Tap: Add one mana of any color usable for that chosen type."},
      "PIR-036": {"id":"PIR-036","name":"Swiftwater Cliffs","cost":"","type":"Land","text":"Swiftwater Cliffs enters tapped. When it enters, you gain 1 life. Tap: Add U or R."},
      "PIR-037": {"id":"PIR-037","name":"Island","cost":"","type":"Basic Land — Island","text":"Tap: Add U."},
      "PIR-038": {"id":"PIR-038","name":"Mountain","cost":"","type":"Basic Land — Mountain","text":"Tap: Add R."}
    };

    async function loadCards() {
      try {
        const res = await fetch('cards.json', {cache: "no-store"});
        if (!res.ok) throw new Error('no cards.json');
        const data = await res.json();
        cardDatabase = data;
      } catch (e) {
        cardDatabase = fallback;
      }
      ids = Object.keys(cardDatabase).sort();
      // Build a hidden simple list for quick keyboard access if user asks to "List IDs"
      idListDiv.textContent = ids.join(' ');
    }

    function announce(msg) {
      announcer.textContent = msg;
    }

    function showCardByIndex(i) {
      if (ids.length === 0) {
        announce('No cards available.');
        return;
      }
      if (i < 0) i = ids.length - 1;
      if (i >= ids.length) i = 0;
      currentIndex = i;
      const id = ids[currentIndex];
      const card = cardDatabase[id];
      displayCard(card);
    }

    function displayCard(card) {
      cardName.textContent = `${card.id} — ${card.name}`;
      cardType.textContent = card.type || '';
      cardCost.textContent = card.cost ? `Cost: ${card.cost}` : '';
      cardText.textContent = card.text || '';
      if (card.power !== undefined && card.power !== null) {
        cardStats.textContent = `Power/Toughness: ${card.power}/${card.toughness}`;
      } else if (card.crew !== undefined) {
        cardStats.textContent = `Crew: ${card.crew}`;
      } else {
        cardStats.textContent = '';
      }
      // Create a simple shareable URL
      const origin = (window.location.protocol === 'file:') ? '' : window.location.origin;
      const base = origin + window.location.pathname;
      const url = `${base}?card=${encodeURIComponent(card.id)}`;
      cardUrlHidden.textContent = url;
      announce(`${card.name} selected. Press C to copy the URL.`);
      // move focus to the card region so screen reader reads it
      document.getElementById('card').focus();
    }

    // Search: try exact ID (case-insensitive), else search by name contains
    function selectByQuery(q) {
      if (!q) return;
      const trimmed = q.trim();
      if (!trimmed) return;
      // exact ID match
      const upper = trimmed.toUpperCase();
      const direct = ids.find(id => id.toUpperCase() === upper);
      if (direct) {
        currentIndex = ids.indexOf(direct);
        showCardByIndex(currentIndex);
        return;
      }
      // name contains
      const found = ids.find(id => {
        const c = cardDatabase[id];
        return c.name && c.name.toLowerCase().includes(trimmed.toLowerCase());
      });
      if (found) {
        currentIndex = ids.indexOf(found);
        showCardByIndex(currentIndex);
        return;
      }
      announce('No matching card found for ' + trimmed);
    }

    // Copy to clipboard with fallback
    async function copyUrl() {
      const url = cardUrlHidden.textContent || '';
      if (!url) { announce('No URL to copy'); return; }
      try {
        await navigator.clipboard.writeText(url);
        announce('URL copied to clipboard');
        copyBtn.textContent = 'Copied';
        setTimeout(()=>copyBtn.textContent='Copy URL',1200);
      } catch (e) {
        // fallback
        const ta = document.createElement('textarea');
        ta.value = url;
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand('copy');
          announce('URL copied to clipboard (fallback)');
        } catch (_) {
          announce('Unable to copy automatically. Please copy manually: ' + url);
        }
        ta.remove();
      }
    }

    function openUrl() {
      const url = cardUrlHidden.textContent || '';
      if (!url) { announce('No URL to open'); return; }
      window.open(url,'_blank','noopener');
      announce('Opened card URL in a new tab');
    }

    // Event listeners
    prevBtn.addEventListener('click', () => {
      showCardByIndex(currentIndex - 1);
    });
    nextBtn.addEventListener('click', () => {
      showCardByIndex(currentIndex + 1);
    });
    copyBtn.addEventListener('click', copyUrl);
    openBtn.addEventListener('click', openUrl);
    listBtn.addEventListener('click', () => {
      // expose the IDs in the announcer for screen reader quick review
      announce('Available IDs: ' + ids.join(', '));
    });

    searchInput.addEventListener('keydown', (ev) => {
      if (ev.key === 'Enter') {
        ev.preventDefault();
        selectByQuery(searchInput.value);
      } else if (ev.key === 'Escape') {
        searchInput.value = '';
      }
    });

    // Global keyboard shortcuts for fast table use
    document.addEventListener('keydown', (ev) => {
      // Ignore when typing in text fields except for shortcuts that make sense
      const active = document.activeElement;
      const isInput = active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA');
      if (ev.key === '/' ) {
        ev.preventDefault();
        searchInput.focus();
        searchInput.select();
        return;
      }
      if (isInput) return; // don't override typing
      if (ev.key === 'ArrowLeft' || ev.key.toLowerCase() === 'p') {
        ev.preventDefault();
        showCardByIndex(currentIndex - 1);
      } else if (ev.key === 'ArrowRight' || ev.key.toLowerCase() === 'n') {
        ev.preventDefault();
        showCardByIndex(currentIndex + 1);
      } else if (ev.key.toLowerCase() === 'c') {
        ev.preventDefault();
        copyUrl();
      } else if (ev.key.toLowerCase() === 'o') {
        ev.preventDefault();
        openUrl();
      } else if (ev.key.toLowerCase() === 'l') {
        ev.preventDefault();
        announce('Available IDs: ' + ids.join(', '));
      }
    });

    // Initialize
    (async function init(){
      await loadCards();
      // default to first card for faster access; comment this line if you prefer placeholder
      if (ids.length) {
        currentIndex = 0;
        showCardByIndex(0);
      } else {
        announce('No cards loaded.');
      }
    })();
  </script>
</body>
</html>